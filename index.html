<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3 Bar Chart</title>
    <div id="main">
        <h1 id="title">United States GDP</h1>
    </div>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        svg {
            background-color: bisque;
        }
    </style>
</head>
<body>
    <script type="module">
        import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
        import {GDP} from "./data.js";
        const find = GDP.data;
        
        let dates = find.map((e)=> {return new Date(e[0])});

        const w = 800;
        const h = 600;
        const padding = 40;

        console.log(dates);
        const xScale = d3.scaleTime().domain([d3.min(dates), d3.max(dates)]).range([padding, w - padding]);
        const xDif = d3.scaleLinear().domain([0, find.length - 1]).range([padding, w - padding]);
        const yScale = d3.scaleLinear().domain([0, d3.max(find, (e) => {return e[1]})]).range([0, h - ( 2 * padding)]);

        const svg = d3.select("div").append("svg").attr("width", w).attr("height", h);

        const xAxis = d3.axisBottom(xScale);
        const yAxis = d3.axisLeft(yScale);

        svg.append("g").call(xAxis).attr("id", "x-axis").attr("transform", "translate(0," + (h - padding) + ")");
        svg.append("g").call(yAxis).attr("id", "y-axis").attr("transform", "translate(" + padding + ", 0)");

        let tooltip = d3.select("body").append("div").attr("id", "tooltip").style("visibility", "hidden").style("width", "auto").style("height", "auto");

        svg.selectAll("rect").data(find).enter().append("rect").attr("class", "bar").attr("width", (w - (2 * padding))/find.length)
            .attr("data-date", (e) => {return e[0]})
            .attr("data-gdp", (e) => {return e[1]})
            .attr("height", (e) => {return yScale(e[1])})
            .attr("x", (e, i) => {return xDif(i)})
            .attr("y", (e) => {return (h - padding) - yScale(e[1])})
            .on("mouseover", (e) => {
                tooltip.transition()
                    .style("visibility", "visible")
                tooltip.text(e[0])
            })

    </script>
</body>
</html>
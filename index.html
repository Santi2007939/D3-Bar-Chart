<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3 Bar Chart</title>
    <div id="main">
        <h1 id="title">United States GDP</h1>
    </div>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
    <script type="module">
        import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
        import {GDP} from "./data.js";
        const find = GDP.data;
        
        let dates = find.map((e)=> {return new Date(e[0])});

        const w = 800;
        const h = 600;
        const p = 40;

        console.log(dates);
        const xScale = d3.scaleTime().domain([d3.min(dates), d3.max(dates)]).range([p, w - p]);
        const xDif = d3.scaleLinear().domain([0, find.length - 1]).range([p, w - p]);
        const yScale = d3.scaleLinear().domain([0, d3.max(find, (e) => {return e[1]})]).range([0, h - (2 * p)]);
        const yDif = d3.scaleLinear().domain([0, d3.max(find, (e) => {return e[1]})]).range([h - p, p])

        const svg = d3.select("div").append("svg").attr("width", w).attr("height", h);

        const xAxis = d3.axisBottom(xScale);
        const yAxis = d3.axisLeft(yDif);

        svg.append("g").call(xAxis).attr("id", "x-axis").attr("transform", "translate(0," + (h - p) + ")");
        svg.append("g").call(yAxis).attr("id", "y-axis").attr("transform", "translate(" + p + ", 0)");

        let tooltip = d3.select("body").append("div").attr("id", "tooltip").style("visibility", "hidden").style("width", "auto").style("height", "auto");

        svg.selectAll("rect").data(find).enter().append("rect").attr("class", "bar").attr("width", (w - (2 * p))/find.length)
            .attr("data-date", (e) => {return e[0]})
            .attr("data-gdp", (e) => {return e[1]})
            .attr("height", (e) => {return yScale(e[1])})
            .attr("x", (e, i) => {return xDif(i)})
            .attr("y", (e, i) => {return (h - p) - yScale(e[1])})
            .on("mouseover", (e, i) => {
                tooltip.transition().style("visibility", "visible");
                tooltip.text(i[0])
                document.querySelector("#tooltip").setAttribute("data-date", i[0]);
            })
            .on("mouseout", (e, i) => {
                tooltip.transition().style("visibility", "hidden");
            })

    </script>
</head>
<body>

</body>
</html>